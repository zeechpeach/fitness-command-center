<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unison</title>
    <link rel="icon" type="image/x-icon" href="src/assets/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://firestore.googleapis.com">
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"
        defer></script>
    <link rel="stylesheet" href="src/css/styles.css">
</head>

<body>
    <div id="app-loading">
        <div class="spinner"></div>
        <div style="font-weight: 500; color: var(--color-text-secondary);">Initializing...</div>
    </div>
    <div class="container">
        <div class="header">
            <h1>Unison</h1>
            <p>Body in unison.</p>
            <button class="settings-btn" onclick="openSettings()" title="Settings">‚öô</button>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" id="workout-tab-btn">Workout</div>
            <div class="nav-tab" id="calendar-tab-btn">Calendar</div>
            <div class="nav-tab" id="nutrition-tab-btn">Nutrition</div>
            <div class="nav-tab" id="body-metrics-tab-btn">Body</div>
            <div class="nav-tab" id="analytics-tab-btn">Analytics</div>
            <div class="nav-tab" id="progress-tab-btn">Progress</div>
            <div class="nav-tab" id="intelligence-tab-btn">Insights</div>
        </div>

        <!-- Travel Mode Banner -->
        <div id="travel-mode-banner" class="travel-mode-banner">
            <div
                style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
                <div>
                    <div
                        style="color: var(--color-warning); font-weight: 600; font-size: 1.1rem; margin-bottom: 0.25rem;">
                        Travel Mode Active</div>
                    <div style="color: var(--color-text-secondary); font-size: 0.9rem;">
                        <span id="travel-mode-dates"></span>
                    </div>
                </div>
                <button class="btn" onclick="endTravelMode()"
                    style="background: rgba(212, 168, 75, 0.15); color: var(--color-warning); border: 1px solid var(--color-warning);">End
                    Travel Mode</button>
            </div>
        </div>

        <!-- WORKOUT TAB -->
        <div id="workout-content" class="tab-content active">
            <div class="workout-day-selector">
                <button class="day-btn active" id="upper-btn">Upper</button>
                <button class="day-btn" id="lower-btn">Lower</button>
                <button class="day-btn" id="rest-btn">Rest</button>
                <button class="day-btn" id="push-btn">Push</button>
                <button class="day-btn" id="pull-btn">Pull</button>
                <button class="day-btn" id="legs-btn">Legs</button>
            </div>

            <div class="workout-controls"
                style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; flex-wrap: wrap;">
                <button class="btn" id="log-past-workout-btn"
                    style="background: rgba(168, 181, 160, 0.15); color: var(--color-accent-primary); border: 1px solid var(--color-accent-secondary);">Log
                    Past Workout</button>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label style="color: var(--color-text-secondary); font-size: 0.9375rem;">Date:</label>
                    <input type="date" id="workout-date-input"
                        style="padding: 0.5rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-sm); color: var(--color-text-primary);">
                </div>
            </div>

            <div class="intensity-inputs">
                <h4 style="color: var(--color-accent-primary); margin-bottom: 1rem;">How are you feeling?</h4>
                <div class="intensity-row">
                    <span class="intensity-label">Energy:</span>
                    <div class="intensity-scale" id="energy-scale">
                        <button class="intensity-btn" data-value="1">1</button>
                        <button class="intensity-btn" data-value="2">2</button>
                        <button class="intensity-btn" data-value="3">3</button>
                        <button class="intensity-btn" data-value="4">4</button>
                        <button class="intensity-btn" data-value="5">5</button>
                    </div>
                    <span style="color: var(--color-text-secondary); font-size: 0.8rem;">Dragging ‚Üí Energetic</span>
                </div>
                <div class="intensity-row">
                    <span class="intensity-label">Motivation:</span>
                    <div class="intensity-scale" id="motivation-scale">
                        <button class="intensity-btn" data-value="1">1</button>
                        <button class="intensity-btn" data-value="2">2</button>
                        <button class="intensity-btn" data-value="3">3</button>
                        <button class="intensity-btn" data-value="4">4</button>
                        <button class="intensity-btn" data-value="5">5</button>
                    </div>
                    <span style="color: var(--color-text-secondary); font-size: 0.8rem;">Forced ‚Üí Eager</span>
                </div>
            </div>

            <div class="intelligence-panel">
                <div class="intelligence-header">
                    <div class="ai-icon">AI</div>
                    <h3>Workout Intelligence</h3>
                </div>
                <div class="suggestions-grid" id="suggestions-container">
                    <div class="suggestion-card">
                        <div class="suggestion-type">Loading...</div>
                        <div class="suggestion-text">Loading AI suggestions...</div>
                    </div>
                </div>
            </div>

            <div id="exercises-container">
                <!-- Exercises will be populated here -->
            </div>

            <div class="intensity-inputs">
                <h4 style="color: var(--color-success); margin-bottom: 1rem;">How did the workout go?</h4>
                <div class="intensity-row">
                    <span class="intensity-label">Fatigue:</span>
                    <div class="intensity-scale" id="fatigue-scale">
                        <button class="intensity-btn" data-value="1">1</button>
                        <button class="intensity-btn" data-value="2">2</button>
                        <button class="intensity-btn" data-value="3">3</button>
                        <button class="intensity-btn" data-value="4">4</button>
                        <button class="intensity-btn" data-value="5">5</button>
                    </div>
                    <span style="color: var(--color-text-secondary); font-size: 0.8rem;">Exhausted ‚Üí Energized</span>
                </div>
                <div class="intensity-row">
                    <span class="intensity-label">Satisfaction:</span>
                    <div class="intensity-scale" id="satisfaction-scale">
                        <button class="intensity-btn" data-value="1">1</button>
                        <button class="intensity-btn" data-value="2">2</button>
                        <button class="intensity-btn" data-value="3">3</button>
                        <button class="intensity-btn" data-value="4">4</button>
                        <button class="intensity-btn" data-value="5">5</button>
                    </div>
                    <span style="color: var(--color-text-secondary); font-size: 0.8rem;">Poor ‚Üí Crushed it</span>
                </div>
            </div>

            <button class="btn-complete" id="complete-workout-btn">Complete Session</button>
        </div>

        <!-- CALENDAR TAB -->
        <div id="calendar-content" class="tab-content">
            <div class="adherence-card">
                <h3 class="analytics-title">Workout Adherence</h3>
                <div class="adherence-score">
                    <div class="adherence-score-value" id="adherence-score">0%</div>
                    <div class="stat-label">Discipline Score</div>
                </div>
                <div class="adherence-stats">
                    <div class="adherence-stat">
                        <div class="adherence-stat-value" id="workouts-completed">0</div>
                        <div class="adherence-stat-label">Completed</div>
                    </div>
                    <div class="adherence-stat">
                        <div class="adherence-stat-value" id="workouts-scheduled">0</div>
                        <div class="adherence-stat-label">Scheduled</div>
                    </div>
                    <div class="adherence-stat">
                        <div class="adherence-stat-value" id="workouts-missed">0</div>
                        <div class="adherence-stat-label">Missed</div>
                    </div>
                </div>
            </div>

            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav-btn" id="prev-month-btn">‚Üê Previous</button>
                    <div class="calendar-month-year" id="calendar-month-year">Loading...</div>
                    <button class="calendar-nav-btn" id="next-month-btn">Next ‚Üí</button>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar will be rendered here -->
                </div>
            </div>

            <div class="selected-day-workout" id="selected-day-workout" style="display: none;">
                <h3 class="analytics-title" id="selected-day-title">Workout Details</h3>
                <div id="selected-day-content">
                    <!-- Selected day workout will be rendered here -->
                </div>
            </div>

            <!-- Schedule Exceptions - Collapsible Section -->
            <div class="schedule-exceptions-section">
                <div class="schedule-exceptions-header" onclick="toggleScheduleExceptions()"
                    style="cursor: pointer; display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-md); margin-top: 1rem;">
                    <h4 style="color: var(--color-text-secondary); font-size: 0.9375rem; margin: 0;">Schedule Exceptions
                    </h4>
                    <span id="schedule-exceptions-toggle"
                        style="color: var(--color-text-secondary); font-size: 1.2rem;">‚ñº</span>
                </div>
                <div id="schedule-exceptions-content" style="display: none; margin-top: 0.5rem;">
                    <!-- Travel Mode Controls -->
                    <div class="travel-mode-controls">
                        <h4 style="color: var(--color-text-secondary); margin-bottom: 0.75rem;">Travel Mode</h4>
                        <div
                            style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap; margin-bottom: 0.75rem;">
                            <div style="flex: 1; min-width: 150px;">
                                <label
                                    style="color: var(--color-text-secondary); font-size: 0.8125rem; display: block; margin-bottom: 0.25rem;">Start
                                    Date</label>
                                <input type="date" id="travel-start-date"
                                    style="width: 100%; padding: 0.5rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-sm); color: var(--color-text-primary);">
                            </div>
                            <div style="flex: 1; min-width: 150px;">
                                <label
                                    style="color: var(--color-text-secondary); font-size: 0.8125rem; display: block; margin-bottom: 0.25rem;">End
                                    Date</label>
                                <input type="date" id="travel-end-date"
                                    style="width: 100%; padding: 0.5rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-sm); color: var(--color-text-primary);">
                            </div>
                            <button class="btn" onclick="enableTravelMode()"
                                style="background: var(--color-bg); color: var(--color-text-secondary); border: 1px solid var(--color-border);">Set
                                Travel Dates</button>
                        </div>
                        <div style="color: var(--color-text-secondary); font-size: 0.8125rem; line-height: 1.5;">
                            Travel mode pauses your workout schedule and excludes days from discipline scores. Your
                            streak won't break during travel.
                        </div>
                    </div>

                    <!-- Sick Day Controls -->
                    <div class="travel-mode-controls">
                        <h4 style="color: var(--color-text-secondary); margin-bottom: 0.75rem;">Sick Day</h4>
                        <div
                            style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap; margin-bottom: 0.75rem;">
                            <div style="flex: 1; min-width: 150px;">
                                <label
                                    style="color: var(--color-text-secondary); font-size: 0.8125rem; display: block; margin-bottom: 0.25rem;">Select
                                    Date</label>
                                <input type="date" id="sick-day-date"
                                    style="width: 100%; padding: 0.5rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-sm); color: var(--color-text-primary);">
                            </div>
                            <button class="btn" onclick="markSickDay()"
                                style="background: var(--color-bg); color: var(--color-text-secondary); border: 1px solid var(--color-border);">Mark
                                as Sick Day</button>
                        </div>
                        <div style="color: var(--color-text-secondary); font-size: 0.8125rem; line-height: 1.5;">
                            Mark a day as sick to cancel the scheduled workout. All remaining workouts will be pushed
                            back by one day, maintaining the intended order.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NUTRITION TAB -->
        <div id="nutrition-content" class="tab-content">
            <!-- Desktop/Tablet: Sidebar Layout | Mobile: Main content with floating button -->
            <div class="nutrition-layout-container">
                <!-- Sidebar for Desktop/Tablet (>768px) -->
                <aside class="nutrition-sidebar">
                    <div class="saved-foods-panel">
                        <h3 class="analytics-title">Saved Foods</h3>
                        <input type="text" id="saved-food-search" class="saved-food-search"
                            placeholder="Search saved foods...">
                        <div class="saved-food-list" id="saved-food-list">
                            <div class="empty-state">No saved foods yet. Save a food from a meal below!</div>
                        </div>
                    </div>
                </aside>

                <!-- Main Content Area -->
                <div class="nutrition-main-content">
                    <!-- Add Food button at top for easy access -->
                    <button class="btn btn-add" onclick="showAddFoodModal()"
                        style="width: 100%; padding: 1rem; font-size: 1rem; margin-bottom: 1.5rem;">+ Add Food</button>

                    <!-- Food logging section -->
                    <div id="meals-container">
                        <!-- Meals will be rendered here -->
                    </div>

                    <!-- Nutrition summary - de-prioritized -->
                    <div class="analytics-card">
                        <h3 class="analytics-title">Daily Nutrition</h3>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <label style="color: var(--color-text-secondary); font-size: 0.9375rem;">Date:</label>
                            <input type="date" id="nutrition-date-input"
                                style="padding: 0.5rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-sm); color: var(--color-text-primary);">
                        </div>
                        <div class="macro-summary">
                            <div class="macro-item">
                                <div class="macro-value" id="total-calories">0</div>
                                <div class="macro-label">Calories</div>
                            </div>
                            <div class="macro-item">
                                <div class="macro-value" id="total-protein">0g</div>
                                <div class="macro-label">Protein</div>
                            </div>
                            <div class="macro-item">
                                <div class="macro-value" id="total-carbs">0g</div>
                                <div class="macro-label">Carbs</div>
                            </div>
                            <div class="macro-item">
                                <div class="macro-value" id="total-fats">0g</div>
                                <div class="macro-label">Fats</div>
                            </div>
                        </div>
                    </div>

                    <div class="calorie-target-card" id="calorie-target-card" style="display: none;">
                        <h3 class="analytics-title">Calorie Target</h3>
                        <div class="calorie-breakdown">
                            <div class="calorie-item">
                                <div class="calorie-value" id="maintenance-calories">--</div>
                                <div class="calorie-label">Maintenance</div>
                            </div>
                            <div class="calorie-item">
                                <div class="calorie-value" id="target-calories">--</div>
                                <div class="calorie-label" id="target-calories-label">Your Goal</div>
                            </div>
                            <div class="calorie-item">
                                <div class="calorie-value" id="calories-remaining">--</div>
                                <div class="calorie-label">Remaining</div>
                            </div>
                        </div>
                        <div
                            style="text-align: center; margin-top: 1rem; color: var(--color-text-secondary); font-size: 0.85rem;">
                            <span id="calorie-update-notice">Calories update automatically when you log weight</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Saved Foods Button (< 768px) -->
            <button class="mobile-saved-foods-btn" onclick="openSavedFoodsModal()">
                Saved Foods
            </button>

            <!-- Modal Backdrop for Mobile -->
            <div class="modal-backdrop" id="saved-foods-backdrop" onclick="closeSavedFoodsModal()"></div>

            <!-- Mobile Saved Foods Modal/Bottom Sheet -->
            <div class="saved-foods-modal" id="saved-foods-modal">
                <div class="modal-header">
                    <h3 class="analytics-title" style="margin-bottom: 0;">Saved Foods</h3>
                    <button class="modal-close-btn" onclick="closeSavedFoodsModal()">√ó</button>
                </div>
                <input type="text" id="saved-food-search-mobile" class="saved-food-search"
                    placeholder="Search saved foods..." oninput="renderSavedFoods(this.value)">
                <div class="saved-food-list" id="saved-food-list-mobile">
                    <div class="empty-state">No saved foods yet. Save a food from a meal below!</div>
                </div>
            </div>
        </div>

        <!-- BODY METRICS TAB -->
        <div id="body-metrics-content" class="tab-content">
            <div class="weight-input-card">
                <h3 class="analytics-title">Weight Tracking</h3>
                <div class="weight-input-row">
                    <input type="date" id="weight-date-input" class="weight-input-field" style="flex: 0.5;">
                    <input type="number" id="weight-value-input" class="weight-input-field" placeholder="Weight (lbs)"
                        step="0.1">
                    <button class="btn btn-complete" onclick="logWeight()"
                        style="margin: 0; padding: 0.75rem 1.5rem;">Log Weight</button>
                </div>
            </div>

            <div class="body-goal-card">
                <h3 class="analytics-title">Body Goal</h3>
                <div class="goal-input-row">
                    <div class="goal-input-group">
                        <label class="goal-input-label">Goal Type</label>
                        <select id="body-goal-select" class="goal-select" onchange="saveBodyGoal()">
                            <option value="">Select Goal</option>
                            <option value="cutting">Cutting (Lose Weight)</option>
                            <option value="bulking">Bulking (Gain Weight)</option>
                            <option value="maintaining">Maintaining (Stay Current)</option>
                        </select>
                    </div>
                    <div class="goal-input-group">
                        <label class="goal-input-label">Target Weight (lbs)</label>
                        <input type="number" id="target-weight-input" class="goal-input"
                            placeholder="Enter target weight" step="0.1" onchange="saveBodyGoal()">
                    </div>
                    <div class="goal-input-group">
                        <label class="goal-input-label">Goal Start Date</label>
                        <input type="date" id="goal-start-date-input" class="goal-input" onchange="saveBodyGoal()">
                    </div>
                </div>
                <div id="goal-display-container" style="display: none;">
                    <div class="goal-display">
                        <div class="goal-display-row">
                            <span class="goal-display-label">Current Weight:</span>
                            <span class="goal-display-value" id="display-current-weight">-- lbs</span>
                        </div>
                        <div class="goal-display-row">
                            <span class="goal-display-label">7-Day Moving Average:</span>
                            <span class="goal-display-value" id="display-moving-avg">-- lbs</span>
                        </div>
                        <div class="goal-display-row">
                            <span class="goal-display-label">Weight to Goal:</span>
                            <span class="goal-display-value" id="display-weight-diff">-- lbs</span>
                        </div>
                        <div class="goal-display-row">
                            <span class="goal-display-label">Estimated Completion:</span>
                            <span class="goal-display-value" id="display-goal-date">--</span>
                        </div>
                    </div>
                    <div id="progress-indicator" class="progress-indicator on-track">
                        <span id="progress-status-text">Set your goal to track progress</span>
                    </div>
                </div>
            </div>

            <div class="analytics-card">
                <h3 class="analytics-title">Weight Progress</h3>
                <div class="chart-container">
                    <canvas id="weight-chart"></canvas>
                </div>
            </div>

            <div class="photo-upload-card">
                <h3 class="analytics-title">Progress Photos</h3>
                <div class="photo-upload-area" onclick="document.getElementById('photo-input').click()">
                    <input type="file" id="photo-input" accept="image/*" style="display: none;"
                        onchange="uploadProgressPhoto(event)">
                    <div style="color: var(--color-text-secondary);">Click to upload a progress photo</div>
                </div>
                <div class="photo-gallery" id="photo-gallery">
                    <!-- Photos will be rendered here -->
                </div>
            </div>
        </div>

        <!-- ANALYTICS TAB -->
        <div id="analytics-content" class="tab-content">
            <!-- Row 1: Main Stats and Volume Cards -->
            <div class="analytics-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                <div class="analytics-card">
                    <h3 class="analytics-title">Personal Records</h3>
                    <div class="stat-value" id="pr-count">0</div>
                    <div class="stat-label">PRs set this week</div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">Workout Streak</h3>
                    <div class="stat-value" id="workout-streak">0</div>
                    <div class="stat-label">consecutive workouts</div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">Upper Volume</h3>
                    <div class="stat-value" id="upper-record">0</div>
                    <div class="stat-label">Record: <span id="upper-record-lbs">0</span> lbs</div>
                    <div class="stat-label">Avg: <span id="upper-avg">0</span> lbs | <span id="upper-trend"></span>
                    </div>
                    <div class="stat-label" style="font-size: 0.8rem; margin-top: 0.5rem;"><span id="upper-mom"></span>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">Lower Volume</h3>
                    <div class="stat-value" id="lower-record">0</div>
                    <div class="stat-label">Record: <span id="lower-record-lbs">0</span> lbs</div>
                    <div class="stat-label">Avg: <span id="lower-avg">0</span> lbs | <span id="lower-trend"></span>
                    </div>
                    <div class="stat-label" style="font-size: 0.8rem; margin-top: 0.5rem;"><span id="lower-mom"></span>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">Push Volume</h3>
                    <div class="stat-value" id="push-record">0</div>
                    <div class="stat-label">Record: <span id="push-record-lbs">0</span> lbs</div>
                    <div class="stat-label">Avg: <span id="push-avg">0</span> lbs | <span id="push-trend"></span></div>
                    <div class="stat-label" style="font-size: 0.8rem; margin-top: 0.5rem;"><span id="push-mom"></span>
                    </div>
                </div>
            </div>

            <!-- Row 2: More Volume Cards -->
            <div class="analytics-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                <div class="analytics-card">
                    <h3 class="analytics-title">Pull Volume</h3>
                    <div class="stat-value" id="pull-record">0</div>
                    <div class="stat-label">Record: <span id="pull-record-lbs">0</span> lbs</div>
                    <div class="stat-label">Avg: <span id="pull-avg">0</span> lbs | <span id="pull-trend"></span></div>
                    <div class="stat-label" style="font-size: 0.8rem; margin-top: 0.5rem;"><span id="pull-mom"></span>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">Legs Volume</h3>
                    <div class="stat-value" id="legs-record">0</div>
                    <div class="stat-label">Record: <span id="legs-record-lbs">0</span> lbs</div>
                    <div class="stat-label">Avg: <span id="legs-avg">0</span> lbs | <span id="legs-trend"></span></div>
                    <div class="stat-label" style="font-size: 0.8rem; margin-top: 0.5rem;"><span id="legs-mom"></span>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">Focus Areas</h3>
                    <div id="focus-areas-content" style="color: var(--color-text-secondary); font-size: 0.9rem;">
                        <p>Complete more workouts to see focus areas!</p>
                    </div>
                </div>
            </div>

            <!-- Row 3: Charts -->
            <div class="chart-grid">
                <div class="analytics-card">
                    <h3 class="analytics-title">PR Timeline</h3>
                    <div style="margin-bottom: 1rem;">
                        <label for="exercise-selector"
                            style="color: var(--color-text-secondary); font-size: 0.9375rem; margin-right: 0.5rem;">Exercise:</label>
                        <select id="exercise-selector"
                            style="padding: 0.5rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-md); color: var(--color-text-primary); font-size: 0.9375rem;">
                            <option value="">Select an exercise</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="pr-timeline-chart"></canvas>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">Session Comparison</h3>
                    <div style="margin-bottom: 1rem;">
                        <label for="comparison-selector"
                            style="color: var(--color-text-secondary); font-size: 0.9375rem; margin-right: 0.5rem;">Workout
                            Type:</label>
                        <select id="comparison-selector"
                            style="padding: 0.5rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-md); color: var(--color-text-primary); font-size: 0.9375rem;">
                            <option value="Upper">Upper</option>
                            <option value="Lower">Lower</option>
                            <option value="Push">Push</option>
                            <option value="Pull">Pull</option>
                            <option value="Legs">Legs</option>
                        </select>
                    </div>
                    <div id="session-comparison-content"
                        style="color: var(--color-text-secondary); font-size: 0.9375rem;">
                        <p>Select a workout type to compare sessions</p>
                    </div>
                </div>
            </div>

            <!-- Row 4: Analytics -->
            <div class="chart-grid">
                <div class="analytics-card">
                    <h3 class="analytics-title">Progression Snapshot</h3>
                    <div id="progression-snapshot" style="color: var(--color-text-secondary); font-size: 0.9375rem;">
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: #1a1a1a;">Quick Wins:</strong>
                            <div id="quick-wins">Complete at least 2 workouts to see recent PRs</div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: var(--color-success);">Trending Up:</strong>
                            <div style="font-size: 0.8rem; color: var(--color-text-secondary); margin-bottom: 0.25rem;">
                                Improving over last 4 sessions</div>
                            <div id="trending-up">N/A</div>
                        </div>
                        <div>
                            <strong style="color: var(--color-warning);">Needs Attention:</strong>
                            <div style="font-size: 0.8rem; color: var(--color-text-secondary); margin-bottom: 0.25rem;">
                                No progress for 3+ sessions</div>
                            <div id="needs-attention">N/A</div>
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">Intensity Heatmap</h3>
                    <div id="intensity-heatmap" style="color: var(--color-text-secondary); font-size: 0.9rem;">
                        <div id="heatmap-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROGRESS TAB -->
        <div id="progress-content" class="tab-content">
            <div class="analytics-card">
                <h3 class="analytics-title">Exercise Progression</h3>
                <div id="exercise-progress-list">
                    <p style="color: var(--color-text-secondary);">Complete some workouts to see your detailed
                        progression!</p>
                </div>
            </div>

            <div class="analytics-card">
                <h3 class="analytics-title">Personal Records</h3>
                <div id="progress-list">
                    <p style="color: var(--color-text-secondary);">Complete some workouts to see your strength
                        progression!</p>
                </div>
            </div>
        </div>

        <!-- INTELLIGENCE TAB -->
        <div id="intelligence-content" class="tab-content">
            <div class="analytics-card">
                <h3 class="analytics-title">AI Insights</h3>
                <ul class="insights-list" id="insights-list">
                    <li class="insight-item">Complete some workouts to get personalized insights!</li>
                </ul>
            </div>

            <div class="analytics-card">
                <h3 class="analytics-title">Nutrition Analytics (Past 7 Days)</h3>
                <div id="nutrition-insights" style="color: var(--color-text-secondary); font-size: 0.9rem;">
                    <div style="margin-bottom: 1rem;">
                        <strong style="color: var(--color-accent-primary);">Workout Days vs Rest Days</strong>
                        <div id="nutrition-comparison" style="margin-top: 0.5rem;">
                            Log nutrition for at least 3 days to see insights
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong style="color: var(--color-success);">Pre-Workout Nutrition</strong>
                        <div id="preworkout-insights" style="margin-top: 0.5rem;">
                            Track meal times to see pre-workout nutrition patterns
                        </div>
                    </div>
                    <div>
                        <strong style="color: var(--color-warning);">Post-Workout Recovery</strong>
                        <div id="postworkout-insights" style="margin-top: 0.5rem;">
                            Track meal times to see post-workout nutrition patterns
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Food Modal - Bottom Sheet Style -->
    <div class="modal-backdrop" id="add-food-backdrop" onclick="closeAddFoodModal()"></div>
    <div class="bottom-sheet-modal" id="add-food-modal">
        <div class="bottom-sheet-handle"></div>
        <div class="bottom-sheet-header">
            <h3 class="bottom-sheet-title">Add Food</h3>
        </div>
        <div class="bottom-sheet-content">
            <div class="tab-toggle">
                <button class="tab-toggle-btn active" id="new-food-tab" onclick="switchAddFoodTab('new')">üìù
                    New</button>
                <button class="tab-toggle-btn" id="saved-food-tab" onclick="switchAddFoodTab('saved')">‚≠ê Saved</button>
            </div>

            <!-- New Food Panel -->
            <div id="new-food-panel">
                <button class="meal-type-btn" onclick="addNewFood()">
                    <div style="font-weight: 600;">Create New Food</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">Enter macros manually</div>
                </button>
            </div>

            <!-- Saved Foods Panel -->
            <div id="saved-food-panel" style="display: none;">
                <input type="text" id="saved-food-search-inline" class="saved-food-search"
                    placeholder="üîç Search saved foods..." oninput="renderInlineSavedFoods(this.value)">
                <div class="saved-food-list" id="saved-food-list-inline" style="max-height: 400px;">
                    <div class="empty-state">No saved foods yet. Save a food to your library!</div>
                </div>
            </div>

            <button class="modal-close" onclick="closeAddFoodModal()" style="margin-top: 1rem;">Cancel</button>
        </div>
    </div>

    <!-- Portion Input Modal - Bottom Sheet Style -->
    <div class="modal-backdrop" id="portion-modal-backdrop" onclick="closePortionModal()"></div>
    <div class="bottom-sheet-modal" id="portion-modal">
        <div class="bottom-sheet-handle"></div>
        <div class="bottom-sheet-header">
            <div class="food-info-header">
                <div class="food-info-name" id="portion-food-name">Food Name</div>
                <div class="food-info-serving" id="portion-food-serving">1 serving = 46g</div>
            </div>
        </div>
        <div class="bottom-sheet-content">
            <div class="portion-input-section">
                <h4>How much?</h4>
                <div class="tab-toggle">
                    <button class="tab-toggle-btn active" id="servings-mode-tab"
                        onclick="switchPortionMode('servings')">Servings</button>
                    <button class="tab-toggle-btn" id="measured-mode-tab"
                        onclick="switchPortionMode('measured')">Measured</button>
                </div>
            </div>

            <!-- Servings Mode -->
            <div id="servings-mode-panel">
                <div class="servings-controls">
                    <button class="serving-adjust-btn" onclick="adjustServings(-1)">‚àí</button>
                    <div class="serving-display" id="servings-display">1</div>
                    <button class="serving-adjust-btn" onclick="adjustServings(1)">+</button>
                </div>
            </div>

            <!-- Measured Mode -->
            <div id="measured-mode-panel" style="display: none;">
                <div class="measured-inputs">
                    <div class="measured-input-group" style="flex: 2;">
                        <label>Amount</label>
                        <input type="number" id="measured-amount-input" placeholder="135" step="0.1" min="0"
                            oninput="calculateServingsFromMeasured()">
                    </div>
                    <div class="measured-input-group">
                        <label>Unit</label>
                        <select id="measured-unit-select" onchange="calculateServingsFromMeasured()">
                            <option value="g">grams</option>
                            <option value="oz">ounces</option>
                            <option value="ml">milliliters</option>
                            <option value="each">each</option>
                            <option value="serving">serving</option>
                        </select>
                    </div>
                </div>
                <div class="calculated-servings" id="calculated-servings" style="display: none;">
                    = <span id="calculated-servings-value">0</span> servings
                </div>
            </div>

            <div class="portion-input-section">
                <h4>Tag as:</h4>
                <div class="meal-tag-buttons">
                    <button class="meal-tag-btn" id="tag-breakfast" onclick="selectMealTag('Breakfast')">üç≥
                        Breakfast</button>
                    <button class="meal-tag-btn" id="tag-lunch" onclick="selectMealTag('Lunch')">‚òÄÔ∏è Lunch</button>
                    <button class="meal-tag-btn" id="tag-dinner" onclick="selectMealTag('Dinner')">üåô Dinner</button>
                    <button class="meal-tag-btn" id="tag-snack" onclick="selectMealTag('Snack')">üç™ Snack</button>
                </div>
            </div>

            <button class="btn-primary-action" id="add-to-log-btn" onclick="addFoodToLog()" disabled>‚úì Add to
                Log</button>
        </div>
    </div>

    <!-- Meal Type Selection Modal (legacy - for new food flow) -->
    <div class="modal-overlay" id="meal-tag-modal">
        <div class="modal-content">
            <h3 class="modal-title">Tag this food as:</h3>
            <div class="meal-type-buttons">
                <button class="meal-type-btn" onclick="tagFood('Breakfast')">üç≥ Breakfast</button>
                <button class="meal-type-btn" onclick="tagFood('Lunch')">‚òÄÔ∏è Lunch</button>
                <button class="meal-type-btn" onclick="tagFood('Dinner')">üåô Dinner</button>
                <button class="meal-type-btn" onclick="tagFood('Snack')">üç™ Snack</button>
            </div>
            <button class="modal-close" onclick="closeMealTagModal()">Cancel</button>
        </div>
    </div>

    <!-- Save Food to Library Modal -->
    <div class="modal-backdrop" id="save-food-backdrop" onclick="closeSaveFoodModal()"></div>
    <div class="bottom-sheet-modal" id="save-food-modal">
        <div class="bottom-sheet-handle"></div>
        <div class="bottom-sheet-header">
            <h3 class="bottom-sheet-title">Save to Library</h3>
        </div>
        <div class="bottom-sheet-content">
            <div class="portion-input-section">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--color-text-secondary);">Food
                    Name</label>
                <input type="text" id="save-food-name" class="measured-input-group input"
                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: var(--radius-md); background: var(--color-surface);"
                    placeholder="Egg Whites">
            </div>

            <div class="portion-input-section">
                <h4>Serving Size</h4>
                <div class="measured-inputs">
                    <div class="measured-input-group" style="flex: 1;">
                        <label>Size</label>
                        <input type="number" id="save-serving-size" placeholder="46" step="0.1" min="0.1">
                    </div>
                    <div class="measured-input-group" style="flex: 1;">
                        <label>Unit</label>
                        <select id="save-serving-unit">
                            <option value="g">grams</option>
                            <option value="oz">ounces</option>
                            <option value="ml">milliliters</option>
                            <option value="each">each</option>
                            <option value="serving">serving</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="portion-input-section">
                <h4>Default portion input</h4>
                <div class="tab-toggle">
                    <button class="tab-toggle-btn" id="save-pref-servings"
                        onclick="selectPortionPreference('servings')">Servings</button>
                    <button class="tab-toggle-btn active" id="save-pref-measured"
                        onclick="selectPortionPreference('measured')">Measured</button>
                </div>
            </div>

            <button class="btn-primary-action" onclick="confirmSaveFood()">üíæ Save to Library</button>
            <button class="modal-close" onclick="closeSaveFoodModal()" style="margin-top: 0.5rem;">Cancel</button>
        </div>
    </div>

    <!-- Create New Food Modal -->
    <div class="modal-backdrop" id="create-food-backdrop" onclick="closeCreateFoodModal()"></div>
    <div class="bottom-sheet-modal" id="create-food-modal">
        <div class="bottom-sheet-handle"></div>
        <div class="bottom-sheet-header">
            <h3 class="bottom-sheet-title">Create New Food</h3>
        </div>
        <div class="bottom-sheet-content">
            <div class="portion-input-section">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--color-text-secondary);">Food
                    Name</label>
                <input type="text" id="create-food-name" class="measured-input-group input"
                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: var(--radius-md); background: var(--color-surface);"
                    placeholder="e.g., Egg Whites">
            </div>

            <div class="portion-input-section">
                <h4>Nutritional Information (per serving)</h4>
                <div class="macro-inputs-grid">
                    <div class="macro-input-wrapper">
                        <label class="macro-input-label">Calories</label>
                        <input type="number" id="create-food-calories" class="macro-input" placeholder="0" step="1"
                            min="0">
                    </div>
                    <div class="macro-input-wrapper">
                        <label class="macro-input-label">Protein (g)</label>
                        <input type="number" id="create-food-protein" class="macro-input" placeholder="0" step="0.1"
                            min="0">
                    </div>
                    <div class="macro-input-wrapper">
                        <label class="macro-input-label">Carbs (g)</label>
                        <input type="number" id="create-food-carbs" class="macro-input" placeholder="0" step="0.1"
                            min="0">
                    </div>
                    <div class="macro-input-wrapper">
                        <label class="macro-input-label">Fats (g)</label>
                        <input type="number" id="create-food-fats" class="macro-input" placeholder="0" step="0.1"
                            min="0">
                    </div>
                </div>
            </div>

            <div class="portion-input-section">
                <h4>Serving Size</h4>
                <div class="measured-inputs">
                    <div class="measured-input-group" style="flex: 1;">
                        <label>Size</label>
                        <input type="number" id="create-food-serving-size" placeholder="46" step="0.1" min="0.1">
                    </div>
                    <div class="measured-input-group" style="flex: 1;">
                        <label>Unit</label>
                        <select id="create-food-serving-unit">
                            <option value="g">grams</option>
                            <option value="oz">ounces</option>
                            <option value="ml">milliliters</option>
                            <option value="each">each</option>
                            <option value="serving">serving</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="portion-input-section">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" id="create-food-save-to-library" checked
                        style="width: 1.25rem; height: 1.25rem;">
                    <span style="color: var(--color-text-primary);">Save to my food library for future use</span>
                </label>
            </div>

            <button class="btn-primary-action" onclick="confirmCreateFood()">‚úì Create & Add to Meal</button>
            <button class="modal-close" onclick="closeCreateFoodModal()" style="margin-top: 0.5rem;">Cancel</button>
        </div>
    </div>

    <!-- Edit Food Modal -->
    <div class="modal-backdrop" id="edit-food-backdrop" onclick="closeEditFoodModal()"></div>
    <div class="bottom-sheet-modal" id="edit-food-modal">
        <div class="bottom-sheet-handle"></div>
        <div class="bottom-sheet-header">
            <h3 class="bottom-sheet-title">Edit Food</h3>
        </div>
        <div class="bottom-sheet-content">
            <input type="hidden" id="edit-food-id">

            <div class="portion-input-section">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--color-text-secondary);">Food
                    Name</label>
                <input type="text" id="edit-food-name" class="measured-input-group input"
                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: var(--radius-md); background: var(--color-surface);"
                    placeholder="e.g., Egg Whites">
            </div>

            <div class="portion-input-section">
                <h4>Nutritional Information (per serving)</h4>
                <div class="macro-inputs-grid">
                    <div class="macro-input-wrapper">
                        <label class="macro-input-label">Calories</label>
                        <input type="number" id="edit-food-calories" class="macro-input" placeholder="0" step="1"
                            min="0">
                    </div>
                    <div class="macro-input-wrapper">
                        <label class="macro-input-label">Protein (g)</label>
                        <input type="number" id="edit-food-protein" class="macro-input" placeholder="0" step="0.1"
                            min="0">
                    </div>
                    <div class="macro-input-wrapper">
                        <label class="macro-input-label">Carbs (g)</label>
                        <input type="number" id="edit-food-carbs" class="macro-input" placeholder="0" step="0.1"
                            min="0">
                    </div>
                    <div class="macro-input-wrapper">
                        <label class="macro-input-label">Fats (g)</label>
                        <input type="number" id="edit-food-fats" class="macro-input" placeholder="0" step="0.1" min="0">
                    </div>
                </div>
            </div>

            <div class="portion-input-section">
                <h4>Serving Size</h4>
                <div class="measured-inputs">
                    <div class="measured-input-group" style="flex: 1;">
                        <label>Size</label>
                        <input type="number" id="edit-food-serving-size" placeholder="46" step="0.1" min="0.1">
                    </div>
                    <div class="measured-input-group" style="flex: 1;">
                        <label>Unit</label>
                        <select id="edit-food-serving-unit">
                            <option value="g">grams</option>
                            <option value="oz">ounces</option>
                            <option value="ml">milliliters</option>
                            <option value="each">each</option>
                            <option value="serving">serving</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="btn-primary-action" onclick="confirmEditFood()">üíæ Save Changes</button>
            <button class="modal-close" onclick="closeEditFoodModal()" style="margin-top: 0.5rem;">Cancel</button>
        </div>
    </div>

    <!-- Alternative Exercise Modal -->
    <div class="alt-exercise-modal" id="alt-exercise-modal">
        <div class="alt-exercise-modal-content">
            <div class="alt-exercise-modal-header">
                <div class="alt-exercise-modal-title">Alternative Exercise</div>
                <button class="alt-exercise-close-btn" onclick="closeAltExerciseModal()">√ó Close</button>
            </div>

            <div class="alt-exercise-input-section">
                <label class="alt-exercise-input-label">Exercise Name</label>
                <input type="text" id="alt-exercise-name-input" class="alt-exercise-name-input"
                    placeholder="Enter alternative exercise name...">
            </div>

            <div class="alt-exercise-history-section" id="alt-exercise-history-section" style="display: none;">
                <div class="alt-exercise-history-title">Previously Used Alternatives</div>
                <div class="alt-exercise-history-list" id="alt-exercise-history-list"></div>
            </div>

            <button class="alt-exercise-confirm-btn" id="alt-exercise-confirm-btn" onclick="confirmAltExercise()">
                Confirm Alternative Exercise
            </button>
        </div>
    </div>

    <!-- Post-Travel Resume Options Modal -->
    <div class="modal-overlay" id="post-travel-modal">
        <div class="modal-content">
            <h3 class="modal-title">Welcome Back!</h3>
            <p style="color: var(--color-text-secondary); margin-bottom: 1.5rem; text-align: center;">How would you like
                to resume your workout program?</p>
            <div class="meal-type-buttons">
                <button class="meal-type-btn" onclick="resumeWorkoutProgram('resume')"
                    style="background: rgba(93, 138, 102, 0.2); border-color: rgba(93, 138, 102, 0.3); color: var(--color-success);">
                    <div style="font-weight: 600;">Resume</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">Continue from where you left off
                    </div>
                </button>
                <button class="meal-type-btn" onclick="resumeWorkoutProgram('restart')"
                    style="background: rgba(74, 93, 74, 0.2); border-color: rgba(74, 93, 74, 0.3); color: var(--color-accent-primary);">
                    <div style="font-weight: 600;">Restart</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">Start the program from day 1
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settings-modal">
        <div class="settings-modal-content">
            <div class="settings-modal-header">
                <h2 class="settings-modal-title">Settings</h2>
                <button class="settings-modal-close" onclick="closeSettings()">√ó</button>
            </div>

            <div class="settings-section">
                <h3 class="settings-section-title">Programs</h3>
                <div id="programs-list">
                    <!-- Programs will be rendered here -->
                </div>
                <button class="btn" onclick="createNewProgram()" style="margin-top: 1rem; width: 100%;">+ Create New
                    Program</button>
            </div>
        </div>
    </div>

    <!-- Program Editor Modal -->
    <div class="program-editor-modal" id="program-editor-modal">
        <div class="program-editor-container">
            <div class="program-editor-header">
                <button class="program-editor-back" onclick="closeProgramEditor()">
                    <span class="back-arrow">‚Üê</span>
                    <span>Back to Settings</span>
                </button>
                <div class="program-editor-title-section">
                    <input type="text" id="program-name-input" class="program-name-input" placeholder="Program Name">
                    <button class="program-name-edit-btn" id="program-name-edit-btn"
                        onclick="toggleProgramNameEdit()">‚úèÔ∏è</button>
                </div>
                <div class="program-editor-actions">
                    <span class="save-indicator" id="save-indicator">Saved</span>
                    <button class="program-delete-btn" id="program-delete-btn"
                        onclick="deleteProgramWithConfirmation()">Delete</button>
                </div>
            </div>

            <div class="program-editor-content">
                <!-- Schedule Section -->
                <div class="program-section">
                    <div class="program-section-header">
                        <h3>Schedule</h3>
                        <div class="cycle-controls">
                            <button class="cycle-btn" onclick="updateCycleLength(-1)">‚àí</button>
                            <span id="cycle-length-display" class="cycle-length-display">7-day cycle</span>
                            <button class="cycle-btn" onclick="updateCycleLength(1)">+</button>
                        </div>
                    </div>
                    <div class="schedule-pills" id="schedule-pills">
                        <!-- Day pills rendered here -->
                    </div>
                </div>

                <!-- Workouts Section -->
                <div class="program-section">
                    <h3>Workouts</h3>
                    <div id="workouts-accordion">
                        <!-- Workout accordions rendered here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Exercise Panel -->
    <div class="exercise-panel" id="exercise-panel">
        <div class="exercise-panel-header">
            <h3 id="exercise-panel-title">Add Exercise</h3>
            <button class="exercise-panel-close" onclick="closeExercisePanel()">√ó</button>
        </div>
        <div class="exercise-panel-content">
            <div class="form-group">
                <label for="exercise-name-input">Exercise Name</label>
                <input type="text" id="exercise-name-input" class="form-input" placeholder="e.g., Barbell Squat">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="exercise-sets-input">Sets</label>
                    <input type="number" id="exercise-sets-input" class="form-input" placeholder="3" min="1">
                </div>
                <div class="form-group">
                    <label for="exercise-reps-input">Reps</label>
                    <input type="text" id="exercise-reps-input" class="form-input" placeholder="8-12 or AMRAP">
                </div>
            </div>
            <div class="form-group">
                <label for="exercise-notes-input">Notes (Optional)</label>
                <textarea id="exercise-notes-input" class="form-textarea"
                    placeholder="Coaching cues or additional instructions..." rows="3"></textarea>
            </div>
        </div>
        <div class="exercise-panel-footer">
            <button class="btn-secondary" onclick="closeExercisePanel()">Cancel</button>
            <button class="btn-primary" onclick="saveExercise()">Save Exercise</button>
            <button class="btn-danger" id="exercise-delete-btn" onclick="deleteCurrentExercise()"
                style="display: none;">Delete</button>
        </div>
    </div>

    <script type="module" src="src/js/app.js"></script>
</body>

</html>